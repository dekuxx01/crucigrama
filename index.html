<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crucigrama: Un Regalo Especial</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --cell-size: 45px;
            --primary: #2d1b4e;
            --accent: #ff2e63;
            --accent-soft: #ff6b9d;
            --bg-body: #f0f4f8;
            --glow-color: #ff2e63;
            --gold: #ffd700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-attachment: fixed;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: background 2.5s ease-in-out;
        }

        /* Partículas flotantes de corazones */
        body::before {
            content: '❤';
            position: fixed;
            top: -50px;
            left: 10%;
            font-size: 20px;
            color: rgba(255, 255, 255, 0.3);
            animation: float 15s infinite ease-in-out;
            z-index: 1;
        }

        body::after {
            content: '❤';
            position: fixed;
            top: -50px;
            right: 15%;
            font-size: 25px;
            color: rgba(255, 182, 193, 0.4);
            animation: float 18s infinite ease-in-out 3s;
            z-index: 1;
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0) rotate(0deg); 
                opacity: 0;
            }
            10% { opacity: 0.6; }
            50% { 
                transform: translateY(100vh) rotate(180deg); 
                opacity: 0.8;
            }
            90% { opacity: 0.4; }
        }

        /* Más partículas decorativas */
        .particula {
            position: fixed;
            pointer-events: none;
            z-index: 1;
        }

        .particula:nth-child(1) { top: 20%; left: 5%; animation: float 12s infinite; font-size: 18px; }
        .particula:nth-child(2) { top: 60%; right: 8%; animation: float 16s infinite 2s; font-size: 22px; }
        .particula:nth-child(3) { top: 40%; left: 85%; animation: float 14s infinite 4s; font-size: 15px; }
        .particula:nth-child(4) { top: 80%; left: 20%; animation: float 20s infinite 1s; font-size: 20px; }

        #titulo {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 900;
            color: white;
            text-align: center;
            margin: 20px 0 40px 0;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4),
                         0 0 40px rgba(255, 46, 99, 0.6);
            letter-spacing: 2px;
            position: relative;
            z-index: 10;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 0 40px rgba(255, 46, 99, 0.6); }
            50% { text-shadow: 0 4px 25px rgba(0, 0, 0, 0.5), 0 0 60px rgba(255, 46, 99, 0.9); }
        }

        .layout {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1300px;
            transition: opacity 2s ease-in-out;
            position: relative;
            z-index: 10;
        }

        #grid-container {
            display: grid;
            grid-template-columns: repeat(13, var(--cell-size));
            grid-template-rows: repeat(15, var(--cell-size));
            gap: 1px;
            background: linear-gradient(135deg, rgba(255, 46, 99, 0.3), rgba(118, 75, 162, 0.3));
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 10px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
                        0 0 100px rgba(255, 46, 99, 0.3),
                        inset 0 0 50px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            animation: gridPulse 4s ease-in-out infinite;
        }

        @keyframes gridPulse {
            0%, 100% { box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 100px rgba(255, 46, 99, 0.3), inset 0 0 50px rgba(255, 255, 255, 0.1); }
            50% { box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6), 0 0 120px rgba(255, 46, 99, 0.5), inset 0 0 60px rgba(255, 255, 255, 0.15); }
        }

        .cell { 
            width: var(--cell-size); 
            height: var(--cell-size); 
            background: linear-gradient(135deg, #4a4a4a 0%, #2d2d2d 100%);
            position: relative; 
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 4px;
        }

        .active-cell { 
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(240, 240, 255, 0.95) 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2),
                        inset 0 1px 3px rgba(255, 255, 255, 0.8);
        }

        .active-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 46, 99, 0.4);
        }
        
        .cell-number {
            position: absolute;
            top: 1px;
            left: 2px;
            font-size: 10px;
            font-weight: bold;
            color: var(--accent);
            z-index: 5;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        /* --- LÓGICA DE ILUMINACIÓN MEJORADA --- */
        .glow-letter {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-soft) 100%) !important;
            color: white !important;
            font-size: 28px !important;
            font-weight: 900 !important;
            box-shadow: 0 0 40px var(--glow-color), 
                        0 0 70px var(--glow-color),
                        0 0 100px var(--glow-color),
                        inset 0 0 25px rgba(255, 255, 255, 0.6) !important;
            transform: scale(1.35) !important;
            z-index: 100 !important;
            border: 3px solid var(--gold) !important;
            border-radius: 8px !important;
            animation: pulseGlow 1.8s ease-in-out infinite;
        }

        .glow-letter input {
            color: white !important;
            font-size: 28px !important;
            font-weight: 900 !important;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5),
                         0 2px 4px rgba(0, 0, 0, 0.8) !important;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 40px var(--glow-color), 
                            0 0 70px var(--glow-color),
                            0 0 100px var(--glow-color),
                            inset 0 0 25px rgba(255, 255, 255, 0.6);
                transform: scale(1.35);
            }
            50% { 
                box-shadow: 0 0 50px var(--glow-color), 
                            0 0 90px var(--glow-color),
                            0 0 130px var(--glow-color),
                            inset 0 0 35px rgba(255, 255, 255, 0.8);
                transform: scale(1.4);
            }
        }

        .dimmed { 
            opacity: 0.15; 
            filter: grayscale(80%);
        }

        .active-cell input {
            width: 100%; 
            height: 100%; 
            border: none;
            text-align: center; 
            font-size: 22px; 
            font-weight: bold;
            text-transform: uppercase; 
            outline: none; 
            background: transparent;
            position: relative; 
            z-index: 2;
            color: var(--primary);
            font-family: 'Poppins', sans-serif;
        }

        .active-cell input:focus {
            color: var(--accent);
        }

        /* --- Panel de Pistas Mejorado --- */
        .clues-panel {
            width: 350px; 
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4),
                        0 0 60px rgba(255, 46, 99, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .clues-panel h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
            padding-bottom: 12px;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #clues-list {
            max-height: 500px; 
            overflow-y: auto;
            padding-right: 10px;
        }

        #clues-list::-webkit-scrollbar {
            width: 8px;
        }

        #clues-list::-webkit-scrollbar-track {
            background: rgba(255, 46, 99, 0.1);
            border-radius: 10px;
        }

        #clues-list::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        #clues-list div {
            margin-bottom: 10px;
            padding: 10px;
            background: linear-gradient(135deg, rgba(255, 46, 99, 0.05), rgba(118, 75, 162, 0.05));
            border-radius: 8px;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        #clues-list div:hover {
            background: linear-gradient(135deg, rgba(255, 46, 99, 0.15), rgba(118, 75, 162, 0.15));
            border-left-color: var(--accent);
            transform: translateX(5px);
        }

        #clues-list b {
            color: var(--accent);
            font-size: 1.1rem;
        }

        /* --- Popup Centrado Mejorado --- */
        #overlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.85); 
            display: none;
            justify-content: center; 
            align-items: center; 
            z-index: 1000;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #love-popup {
            width: 90%; 
            max-width: 500px; 
            background: linear-gradient(135deg, #ffffff 0%, #fdf2f8 100%);
            padding: 40px;
            border-radius: 20px; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            text-align: center; 
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6),
                        0 0 80px rgba(255, 46, 99, 0.3);
            border: 4px solid var(--accent);
            animation: popupSlide 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popupSlide {
            from { transform: scale(0.7) translateY(-30px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .close-popup { 
            position: absolute; 
            top: -20px; 
            right: -20px;
            cursor: pointer; 
            font-size: 40px; 
            font-weight: 900; 
            color: white; 
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-soft) 100%);
            width: 55px; 
            height: 55px; 
            border-radius: 50%;
            display: flex; 
            align-items: center; 
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            line-height: 0; 
            transition: transform 0.2s;
            border: 3px solid white;
        }

        .close-popup:hover {
            transform: rotate(90deg) scale(1.1);
        }

        #pop-img { 
            width: 100%; 
            max-width: 100%;
            height: 280px;
            object-fit: cover; 
            object-position: center;
            border-radius: 10px; 
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.6);
        }

        #pop-title { 
            font-family: 'Playfair Display', serif;
            color: var(--accent); 
            font-size: 26px; 
            margin: 0 0 15px 0; 
            font-weight: 800;
            text-shadow: 0 2px 6px rgba(255, 46, 99, 0.2);
        }

        #pop-text { 
            font-style: italic; 
            font-size: 18px; 
            color: #333; 
            margin: 0; 
            line-height: 1.5;
        }

        /* --- Escena Final Mejorada --- */
        #escena-final {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100vw; 
            height: 100vh;
            background: radial-gradient(circle at center, #1a0033 0%, #000000 100%);
            display: none; 
            flex-direction: row;
            justify-content: center; 
            align-items: center; 
            z-index: 2000;
        }

        .texto-final {
            font-family: 'Playfair Display', serif;
            font-size: 3.2rem; 
            font-weight: 800; 
            color: white;
            text-shadow: 0 0 20px var(--accent),
                         0 0 40px var(--accent);
            opacity: 0; 
            transition: opacity 2s ease;
            display: flex; 
            align-items: center; 
            gap: 20px;
        }

        .corazon-final { 
            font-size: 4.5rem; 
            color: var(--accent); 
            animation: latido 1.2s infinite;
            filter: drop-shadow(0 0 20px var(--accent));
        }

        @keyframes latido { 
            0%, 100% { transform: scale(1); } 
            50% { transform: scale(1.2); } 
        }

        /* Responsive */
        @media (max-width: 768px) {
            #titulo { font-size: 2.2rem; }
            .texto-final { font-size: 2rem; }
            .corazon-final { font-size: 3rem; }
            #grid-container { transform: scale(0.85); }
        }

    </style>
</head>
<body>

    <!-- Partículas decorativas -->
    <div class="particula">❤</div>
    <div class="particula">❤</div>
    <div class="particula">❤</div>
    <div class="particula">❤</div>

    <audio id="musica-fondo" loop><source src="musica/ambiente.mp3" type="audio/mpeg"></audio>
    <audio id="sonido-exito"><source src="musica/exito.mp3" type="audio/mpeg"></audio>

    <h1 id="titulo">Crucigrama del Amor</h1>

    <div class="layout" id="main-layout">
        <div id="grid-container"></div>
        <div class="clues-panel" id="pistas-panel">
            <h3>Pistas</h3>
            <div id="clues-list"></div>
        </div>
    </div>

    <div id="overlay">
        <div id="love-popup">
            <span class="close-popup" onclick="cerrarPopup()">×</span>
            <img id="pop-img" src="" alt="Arte">
            <h4 id="pop-title"></h4>
            <p id="pop-text"></p>
        </div>
    </div>

    <div id="escena-final">
        <div class="texto-final" id="pregunta">
            <span>¿QUIERES SER MI SAN VALENTIN?</span>
            <span class="corazon-final">❤</span>
        </div>
    </div>

    <script>
        const ROWS = 15; const COLS = 13;
        let musicaIniciada = false;
        let completadas = new Set();

        const words = [
            { num: 1, id: "MONET", orient: "H", r: 2, c: 1, len: 5, img: "imagenes/monet.jpg", clue: "Pintor impresionista famoso por sus nenúfares", msg: "Monet pasó literalmente años de su vida pintando el mismo estanque una y otra vez, obsesionado con capturar cada cambio de luz, cada reflejo. La gente pensaba que estaba loco. Yo lo entiendo perfectamente, porque así me pasa con vos: podría pasar horas mirándote y nunca sería suficiente." },
            { num: 2, id: "VENUS", orient: "V", r: 0, c: 3, len: 5, img: "imagenes/venus.jpg", clue: "Diosa del amor en 'El Nacimiento de ___' de Botticelli", msg: "Botticelli inmortalizó a Venus emergiendo del mar en una concha, perfecta y divina. Pero dejame decirte algo: ni toda la belleza renacentista del mundo podría competir con vos cuando te reís de mis chistes malos y pretendés que no te divierte." },
            { num: 3, id: "GRITO", orient: "H", r: 5, c: 1, len: 5, img: "imagenes/grito.jpg", clue: "Obra expresionista de Munch que transmite angustia existencial", msg: "'El Grito' de Munch captura la ansiedad del alma moderna... y es exactamente lo que siento internamente cada vez que tardás más de 5 minutos en responder mis mensajes. ¿Ves lo que me hacés?" },
            { num: 4, id: "GUERNICA", orient: "V", r: 5, c: 1, len: 8, img: "imagenes/guernica.jpg", clue: "Mural antibélico de Picasso sobre el bombardeo español", msg: "Hablamos del 'Guernica' de Picasso y su caos monumental... pero ni todo ese desorden en blanco y negro se compara al hermoso desastre que hacés en mis pensamientos cada vez que me mirás con esos ojos que desarman cualquier defensa que intente construir." },
            { num: 5, id: "NOCHE", orient: "V", r: 4, c: 5, len: 5, img: "imagenes/noche.jpg", clue: "Van Gogh pintó una '_____ Estrellada' icónica", msg: "Van Gogh pintó 'La Noche Estrellada' en un manicomio, convirtiendo su tormento en belleza eterna. Vos convertís mis días ordinarios en obras maestras solo con existir en ellos. ¿Es justo eso? Probablemente no. ¿Me importa? Para nada." },
            { num: 6, id: "GIOCONDA", orient: "V", r: 7, c: 9, len: 8, img: "imagenes/gioconda.jpg", clue: "Otro nombre de 'La Mona Lisa' de Da Vinci", msg: "La Gioconda guarda su enigmática sonrisa hace siglos, y el mundo sigue preguntándose qué pensaba Lisa Gherardini. Yo tengo mi propio misterio sin resolver: ¿cómo alguien tan increíble como vos no se da cuenta de que me tiene completamente hechizado?" },
            { num: 7, id: "QUERUBINES", orient: "H", r: 8, c: 3, len: 10, img: "imagenes/querubines.jpg", clue: "Ángeles infantiles presentes en 'La Madonna Sixtina' de Rafael", msg: "Los querubines de Rafael son iconos del arte renacentista, con sus caritas de aburrimiento celestial. Pero si ellos supieran lo que es estar cerca tuyo, hasta esos angelitos dejarían de mirar al cielo y prestarían atención al verdadero milagro que tengo frente a mí." },
            { num: 8, id: "BARROCO", orient: "H", r: 12, c: 0, len: 7, img: "imagenes/barroco.jpg", clue: "Estilo artístico dramático y ornamentado del siglo XVII", msg: "El Barroco se caracteriza por su dramatismo excesivo, su intensidad emocional desbordada... básicamente, es el estilo artístico que mejor describe cómo me siento cada vez que estamos juntos. Sutil no soy, pero sincero siempre." },
            { num: 9, id: "PINCELES", orient: "V", r: 6, c: 10, len: 8, img: "imagenes/pincel.jpg", clue:"Herramientas esenciales del pintor (Plural)", msg: "Los pinceles son las herramientas que dan vida al lienzo en blanco. Sin vos, mi mundo sería exactamente eso: un lienzo vacío, sin color, sin forma, sin nada que valga la pena mostrar." },
        ];

        const activeCells = new Map();
        const startCells = new Map();

        words.forEach(w => {
            const key = `${w.r}-${w.c}`;
            if (!startCells.has(key)) startCells.set(key, []);
            startCells.get(key).push(w.num);
            for (let i = 0; i < w.len; i++) {
                let r = w.orient === "V" ? w.r + i : w.r;
                let c = w.orient === "H" ? w.c + i : w.c;
                let k = `${r}-${c}`;
                if (!activeCells.has(k)) activeCells.set(k, []);
                activeCells.get(k).push(w);
            }
        });

        function init() {
            const grid = document.getElementById('grid-container');
            const list = document.getElementById('clues-list');
            words.forEach(w => { list.innerHTML += `<div style="margin-bottom:10px"><b>${w.num}.</b> ${w.clue}</div>`; });

            for (let r = 0; r < ROWS; r++) {
                for (let c = 0; c < COLS; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    const key = `${r}-${c}`;
                    if (activeCells.has(key)) {
                        cell.classList.add('active-cell');
                        cell.id = `cell-${key}`;
                        if (startCells.has(key)) {
                            const numSpan = document.createElement('span');
                            numSpan.className = 'cell-number';
                            numSpan.innerText = startCells.get(key).join(', ');
                            cell.appendChild(numSpan);
                        }
                        const input = document.createElement('input');
                        input.type = 'text'; input.maxLength = 1;
                        input.dataset.row = r; input.dataset.col = c;
                        input.addEventListener('input', () => { 
                            if (!musicaIniciada) { document.getElementById('musica-fondo').play(); musicaIniciada = true; }
                            verificar(key); 
                        });
                        input.addEventListener('keydown', navegar);
                        cell.appendChild(input);
                    }
                    grid.appendChild(cell);
                }
            }
        }

        function navegar(e) {
            let r = parseInt(this.dataset.row), c = parseInt(this.dataset.col);
            if (e.key === "ArrowUp") r--; else if (e.key === "ArrowDown") r++;
            else if (e.key === "ArrowLeft") c--; else if (e.key === "ArrowRight") c++;
            else return;
            const next = document.querySelector(`input[data-row="${r}"][data-col="${c}"]`);
            if (next) next.focus();
        }

        function verificar(key) {
            activeCells.get(key).forEach(w => {
                let curr = "";
                for (let i = 0; i < w.len; i++) {
                    let r = w.orient === "V" ? w.r + i : w.r;
                    let c = w.orient === "H" ? w.c + i : w.c;
                    curr += document.querySelector(`input[data-row="${r}"][data-col="${c}"]`).value.toUpperCase();
                }
                if (curr === w.id && !completadas.has(w.id)) {
                    completadas.add(w.id);
                    lanzarPopup(w);
                    if (completadas.size === words.length) setTimeout(transicionFinal, 3000);
                }
            });
        }

        function lanzarPopup(w) {
            document.getElementById('sonido-exito').play();
            document.getElementById('pop-img').src = w.img;
            document.getElementById('pop-title').innerText = w.id;
            document.getElementById('pop-text').innerText = w.msg;
            document.getElementById('overlay').style.display = 'flex';
        }

        function cerrarPopup() { document.getElementById('overlay').style.display = 'none'; }

        async function transicionFinal() {
            document.body.style.backgroundColor = "black";
            document.getElementById('titulo').style.opacity = "0";
            document.querySelectorAll('.cell').forEach(c => c.classList.add('dimmed'));

            // SECUENCIA EXACTA DE TU CÓDIGO ORIGINAL
            const secuencia = [
                ["8-3", "8-7", "7-10", "2-4", "5-2", "7-1", "8-12"], // QUIERES
                "WAIT",
                ["4-3", "8-11", "12-3"],                             // SER
                "WAIT",
                ["2-1", "8-9"],                                      // MI
                "WAIT",
                ["12-1", "8-10"],                                    // SAN
                "WAIT",
                ["0-3", "14-9", "11-10", "8-5", "4-5", "2-5", "5-3", "2-3"] // VALENTIN
            ];

            for (let item of secuencia) {
                if (item === "WAIT") {
                    await new Promise(r => setTimeout(r, 1400)); // Mayor pausa entre palabras
                } else {
                    for (let coord of item) {
                        const cell = document.getElementById(`cell-${coord}`);
                        if (cell) {
                            cell.classList.remove('dimmed');
                            cell.classList.add('glow-letter');
                        }
                        await new Promise(r => setTimeout(r, 350)); // Tiempo entre letras de la misma palabra
                    }
                }
            }

            setTimeout(() => {
                document.getElementById('main-layout').style.opacity = "0";
                setTimeout(() => {
                    document.getElementById('main-layout').style.display = "none";
                    document.getElementById('escena-final').style.display = "flex";
                    setTimeout(() => { document.getElementById('pregunta').style.opacity = "1"; }, 500);
                }, 1500);
            }, 2000); // Pausa más larga antes de mostrar la pregunta final
        }

        init();
    </script>
</body>
</html>